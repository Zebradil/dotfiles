#!/bin/bash
# vim: set ft=bash :

set -euo pipefail

header(){
    printf " :$1: " | xargs -d: -n1 printf '\033[1;30;42m %-40s \033[0m\n'
}

header "Updating Chemacs2"

git -C "${HOME}/.emacs.d" pull

header "Updating Emacs Doom"

DOOM_DIR="{{.emacs_doom_dir}}"
DOOM_DIR="${DOOM_DIR/#\~/$HOME}"
readonly DOOM_DIR
"${DOOM_DIR}/bin/doom" --yes upgrade

header "Updating Spacemacs"

SPACEMACS_DIR="{{.emacs_spacemacs_dir}}"
SPACEMACS_DIR="${SPACEMACS_DIR/#\~/$HOME}"
readonly SPACEMACS_DIR
git -C "$SPACEMACS_DIR" pull

emacs \
    -l "${HOME}/.emacs.d/init.el" \
    --with-profile spacemacs \
    --batch \
    --eval="(configuration-layer/update-packages t)"

header "Restarting emacs.service"

systemctl restart --no-block --user emacs
